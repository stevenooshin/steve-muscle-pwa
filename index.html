<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Steve’s Muscle Gain</title>
  <meta name="theme-color" content="#0b0b0f" />

  <!-- PWA assets (relative paths for GitHub Pages) -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- Tailwind for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (UMD) + ReactDOM + Babel (for JSX in browser) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>

  <style>
    *{box-sizing:border-box}
    body{background:#0b0b0f;color:#e8e8ec;font:15px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    #err{display:none;background:#fee;color:#900;padding:10px;font:14px/1.4 system-ui;white-space:pre-wrap}
  </style>
</head>
<body class="bg-neutral-950">
  <div id="err"></div>
  <div id="root"></div>

  <!-- Register service worker (relative path!) -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(() => {});
      });
    }
  </script>

  <!-- YOUR APP CODE MUST BE INSIDE THIS BABEL SCRIPT -->
  <script type="text/babel" data-presets="env,react">
    const {useEffect,useMemo,useState} = React;
    const STORAGE_KEY = "steve_muscle_app_v1";
    const todayISO = () => new Date().toISOString().slice(0,10);
    const cls = (...a)=>a.filter(Boolean).join(" ");

    const WEEK_PLAN=[
      { title:"Lower Body (Leg Focus)", blocks:[
        {name:"Back Squat",sets:"4×8–10"}, {name:"Walking Lunges",sets:"3×12/leg"},
        {name:"Romanian Deadlift",sets:"3×8"}, {name:"Calf Raises",sets:"4×15–20"},
        {name:"Leg Press (opt)",sets:"3×12"} ], cardio:null },
      { title:"Upper Push (Chest/Shoulders/Triceps)", blocks:[
        {name:"Bench Press / Push-Ups",sets:"4×8–10"}, {name:"Overhead Press",sets:"3×8–10"},
        {name:"Incline DB Press",sets:"3×10"}, {name:"Dips",sets:"3×max"} ], cardio:null },
      { title:"Active Recovery + Run", blocks:[
        {name:"Plank",sets:"3×60s"}, {name:"Hanging Leg Raises",sets:"3×12"} ],
        cardio:"20–30 min easy run (beach/treadmill)" },
      { title:"Lower Body + Glutes", blocks:[
        {name:"Deadlift",sets:"4×6–8"}, {name:"Bulgarian Split Squat",sets:"3×10/leg"},
        {name:"Step-Ups",sets:"3×12/leg"}, {name:"Hip Thrust",sets:"3×12"} ], cardio:null },
      { title:"Upper Pull (Back/Biceps)", blocks:[
        {name:"Pull-Ups / Lat Pulldown",sets:"4×8–10"}, {name:"Barbell Row",sets:"4×8"},
        {name:"DB Curls",sets:"3×10–12"}, {name:"Face Pulls",sets:"3×12–15"} ], cardio:null },
      { title:"Run + Bodyweight Circuit", blocks:[
        {name:"Circuit: Push-Ups",sets:"3 rounds"}, {name:"Air Squats",sets:"3 rounds"},
        {name:"Plank",sets:"3 rounds"} ], cardio:"15–20 min steady run" },
      { title:"Rest / Recovery", blocks:[], cardio:null },
    ];

    const MEAL_TEMPLATE=[
      {name:"Breakfast: 4 eggs, 2 slices bread, banana, milk/laban"},
      {name:"Snack: Peanut butter + 3–4 dates"},
      {name:"Lunch: 200g chicken (thigh/breast) + 1 cup rice + salad"},
      {name:"Pre-workout: Banana or small sandwich"},
      {name:"Post-workout: Rule 1 Mass Gainer"},
      {name:"Dinner: 150g fish (tilapia/sheri) or minced beef + carb + veg"},
      {name:"Before bed: Milk or Greek yogurt"},
    ];

    const SUPPS=[
      {name:"Creatine Monohydrate 5g (daily – any time)"},
      {name:"Rule 1 Mass Gainer (post-workout – rest days between meals)"},
    ];

    function loadState(){try{const raw=localStorage.getItem("steve_muscle_app_v1");return raw?JSON.parse(raw):null;}catch{return null}}
    function saveState(s){localStorage.setItem("steve_muscle_app_v1", JSON.stringify(s))}
    const defaultState={checks:{},metrics:[],settings:{usesMilkInGainer:false,units:"metric"}};

    const Pill=({active,children,onClick})=> (
      <button onClick={onClick} className={cls("px-3 py-1 rounded-full text-sm transition",active?"bg-indigo-600 text-white":"bg-neutral-800 text-neutral-200 hover:bg-neutral-700")}>{children}</button>
    );

    const Card=({children})=> (
      <div className="bg-neutral-900/70 rounded-2xl ring-1 ring-white/5 shadow-lg p-4">{children}</div>
    );

    const Section=({title,children,right})=> (
      <div className="mb-6">
        <div className="flex items-center justify-between mb-2">
          <h3 className="text-lg font-semibold text-white">{title}</h3>{right}
        </div>
        <Card>{children}</Card>
      </div>
    );

    const CheckboxRow=({label,checked,onChange,sub})=> (
      <label className="flex items-start gap-3 py-2">
        <input type="checkbox" className="mt-1 accent-indigo-600" checked={checked} onChange={e=>onChange(e.target.checked)} />
        <div>
          <div className="font-medium text-neutral-100">{label}</div>
          {sub && <div className="text-xs text-neutral-400">{sub}</div>}
        </div>
      </label>
    );

    const Input=({label,value,onChange,type="text"})=> (
      <label className="text-sm grid gap-1">
        <span className="text-neutral-400">{label}</span>
        <input type={type} value={value} onChange={e=>onChange(e.target.value)} className="rounded-xl bg-neutral-900 ring-1 ring-white/10 px-3 py-2 text-neutral-100" />
      </label>
    );

    const dateFromDow=(targetDow)=>{const now=new Date();const diff=(targetDow-now.getDay()+7)%7;const d=new Date(now);d.setDate(now.getDate()+diff);return d.toISOString().slice(0,10)};

    function Progress({metrics,onAdd}){
      const [form,setForm]=useState({date:todayISO(),weightKg:"",chest:"",waist:"",hips:"",leftArm:"",rightArm:"",leftThigh:"",rightThigh:"",leftCalf:"",rightCalf:"",notes:""});
      return (
        <Section title="Progress Tracker (cm)">
          <div className="grid gap-4">
            <div className="grid sm:grid-cols-2 gap-3">
              <Input label="Date" type="date" value={form.date} onChange={v=>setForm(f=>({...f,date:v}))} />
              <Input label="Body weight (kg)" type="number" value={form.weightKg} onChange={v=>setForm(f=>({...f,weightKg:v}))} />
              <Input label="Chest (cm)" type="number" value={form.chest} onChange={v=>setForm(f=>({...f,chest:v}))} />
              <Input label="Waist (cm)" type="number" value={form.waist} onChange={v=>setForm(f=>({...f,waist:v}))} />
              <Input label="Hips (cm)" type="number" value={form.hips} onChange={v=>setForm(f=>({...f,hips:v}))} />
              <Input label="Left arm (cm)" type="number" value={form.leftArm} onChange={v=>setForm(f=>({...f,leftArm:v}))} />
              <Input label="Right arm (cm)" type="number" value={form.rightArm} onChange={v=>setForm(f=>({...f,rightArm:v}))} />
              <Input label="Left thigh (cm)" type="number" value={form.leftThigh} onChange={v=>setForm(f=>({...f,leftThigh:v}))} />
              <Input label="Right thigh (cm)" type="number" value={form.rightThigh} onChange={v=>setForm(f=>({...f,rightThigh:v}))} />
              <Input label="Left calf (cm)" type="number" value={form.leftCalf} onChange={v=>setForm(f=>({...f,leftCalf:v}))} />
              <Input label="Right calf (cm)" type="number" value={form.rightCalf} onChange={v=>setForm(f=>({...f,rightCalf:v}))} />
              <Input label="Notes" value={form.notes} onChange={v=>setForm(f=>({...f,notes:v}))} />
            </div>
            <div><button onClick={()=>onAdd(form)} className="px-4 py-2 rounded-xl bg-indigo-600 text-white">Save Entry</button></div>
            <div>
              <h4 className="font-semibold mb-2">History</h4>
              <div className="bg-neutral-900/60 rounded-2xl divide-y divide-white/5">
                {[...metrics].sort((a,b)=>a.date<b.date?-1:1).map((m,i)=>(
                  <div key={i} className="p-3 text-sm grid grid-cols-2 gap-x-6 gap-y-1 sm:flex sm:flex-wrap">
                    <div className="font-medium w-24">{m.date}</div>
                    <div>Weight: {m.weightKg} kg</div>
                    {m.chest && <div>Chest: {m.chest} cm</div>}
                    {m.waist && <div>Waist: {m.waist} cm</div>}
                    {m.hips && <div>Hips: {m.hips} cm</div>}
                    {m.leftArm && <div>L Arm: {m.leftArm} cm</div>}
                    {m.rightArm && <div>R Arm: {m.rightArm} cm</div>}
                    {m.leftThigh && <div>L Thigh: {m.leftThigh} cm</div>}
                    {m.rightThigh && <div>R Thigh: {m.rightThigh} cm</div>}
                    {m.leftCalf && <div>L Calf: {m.leftCalf} cm</div>}
                    {m.rightCalf && <div>R Calf: {m.rightCalf} cm</div>}
                    {m.notes && <div className="text-neutral-400">{m.notes}</div>}
                  </div>
                ))}
                {metrics.length===0 && <div className="p-3 text-sm text-neutral-400">No entries yet.</div>}
              </div>
            </div>
          </div>
        </Section>
      );
    }

    function App(){
      const [state,setState]=useState(()=>loadState()||defaultState);
      const [tab,setTab]=useState("today");
      const [date,setDate]=useState(todayISO());
      useEffect(()=>saveState(state),[state]);

      const dayIndex=useMemo(()=>new Date(date).getDay(),[date]);
      const dayPlan=WEEK_PLAN[dayIndex];
      const checks=state.checks[date]||{meals:{},workout:{},supps:{}};

      function updateChecks(part,key,val){
        setState(s=>({...s,checks:{...s.checks,[date]:{
          meals:{...(s.checks[date]?.meals||{}),...(part==="meals"?{[key]:val}:{})},
          workout:{...(s.checks[date]?.workout||{}),...(part==="workout"?{[key]:val}:{})},
          supps:{...(s.checks[date]?.supps||{}),...(part==="supps"?{[key]:val}:{})},
        }}}));
      }
      function resetToday(){ setState(s=>({...s,checks:{...s.checks,[date]:{meals:{},workout:{},supps:{}}}})); }
      function addMetric(entry){ setState(s=>({...s,metrics:[...s.metrics.filter(m=>m.date!==entry.date),entry]})); }
      function markAllWorkouts(val){
        const next={...(state.checks[date]?.workout||{})};
        (dayPlan.blocks||[]).forEach(b=>{next[b.name]=val;});
        if(dayPlan.cardio) next["cardio"]=val;
        setState(s=>({...s,checks:{...s.checks,[date]:{ meals:s.checks[date]?.meals||{}, workout:next, supps:s.checks[date]?.supps||{} }}}));
      }

      return (
        <div className="min-h-screen bg-gradient-to-b from-neutral-950 to-neutral-900 p-4 pb-24 md:p-6">
          <div className="max-w-2xl mx-auto">
            <header className="sticky top-0 z-10 bg-neutral-950/80 backdrop-blur rounded-2xl px-4 py-3 mb-4 ring-1 ring-white/5">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-xl font-bold text-white">Steve’s Muscle Gain</h1>
                  <div className="text-xs text-neutral-400">Simple • Fast • Consistent</div>
                </div>
                <input type="date" className="rounded-xl bg-neutral-900 ring-1 ring-white/10 px-3 py-2 text-neutral-100" value={date} onChange={e=>setDate(e.target.value)} />
              </div>
            </header>

            <nav id="topnav" className="flex gap-2 mb-4 overflow-auto">
              {["today","workouts","meals","supps","progress","settings"]
                .map(k=> (<Pill key={k} active={tab===k} onClick={()=>setTab(k)}>{k[0].toUpperCase()+k.slice(1)}</Pill>))}
            </nav>

            {tab==="today" && (<>
              <Section title={`Today – ${dayPlan.title}`} right={<button onClick={resetToday} className="text-sm underline">Reset</button>}>
                <div className="space-y-2">
                  {dayPlan.blocks.length>0? dayPlan.blocks.map((b,i)=>(
                    <CheckboxRow key={i} label={`${b.name} (${b.sets})`} checked={!!checks.workout[b.name]} onChange={v=>updateChecks("workout",b.name,v)} />
                  )): (<div className="text-sm text-neutral-400">Rest day – recovery & steps.</div>)}
                  {dayPlan.cardio && (<CheckboxRow label={dayPlan.cardio} checked={!!checks.workout["cardio"]} onChange={v=>updateChecks("workout","cardio",v)} />)}
                </div>
              </Section>
              <Section title="Meals (check as you eat)">
                <div className="space-y-2">{MEAL_TEMPLATE.map((m,i)=>(
                  <CheckboxRow key={i} label={m.name} checked={!!checks.meals[i]} onChange={v=>updateChecks("meals",i,v)} />
                ))}</div>
              </Section>
              <Section title="Supplements">
                <div className="space-y-2">{SUPPS.map((s,i)=>(
                  <CheckboxRow key={i} label={s.name} checked={!!checks.supps[i]} onChange={v=>updateChecks("supps",i,v)} />
                ))}</div>
              </Section>
            </>)}

            {tab==="workouts" && (
              <Section title={`Workouts – ${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dayIndex]}`}>
                <div className="flex flex-wrap gap-2 mb-4">{["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((dName,i)=>(
                  <button key={dName} onClick={()=>setDate(dateFromDow(i))}
                    className={cls("px-3 py-1 rounded-full text-sm", i===dayIndex? "bg-indigo-600 text-white":"bg-neutral-800 text-neutral-200")}>{dName}</button>
                ))}</div>
                <div className="flex gap-2 mb-3">
                  <button onClick={()=>markAllWorkouts(true)} className="px-3 py-1 rounded-xl bg-green-600 text-white text-sm">Mark All Done</button>
                  <button onClick={()=>markAllWorkouts(false)} className="px-3 py-1 rounded-xl bg-rose-600 text-white text-sm">Clear All</button>
                </div>
                <div className="space-y-2">
                  {dayPlan.blocks.length>0? dayPlan.blocks.map((b,i)=>(
                    <CheckboxRow key={i} label={`${b.name} (${b.sets})`} checked={!!checks.workout[b.name]} onChange={v=>updateChecks("workout",b.name,v)} />
                  )): (<div className="text-sm text-neutral-400">Rest day – recovery & steps.</div>)}
                  {dayPlan.cardio && (<CheckboxRow label={dayPlan.cardio} checked={!!checks.workout["cardio"]} onChange={v=>updateChecks("workout","cardio",v)} />)}
                </div>
              </Section>
            )}

            {tab==="meals" && (<>
              <Section title="Cheap High-Protein Daily Plan (UAE)">
                <ul className="list-disc pl-5 text-sm space-y-1">{MEAL_TEMPLATE.map((m,i)=>(<li key={i}>{m.name}</li>))}</ul>
                <div className="text-xs text-neutral-400 mt-3">Bulk-cook rice and chicken for 3–4 days. Hydrate 3–4 L/day, especially with creatine.</div>
              </Section>
              <Section title="Grocery Checklist">
                <ul className="grid grid-cols-2 gap-2 text-sm">{[
                  "Eggs","Brown bread","Bananas","Milk/Laban","Peanut butter","Dates","Chicken (thigh)","Rice/Pasta","Olive oil","Fish (tilapia/sheri)","Minced beef","Sweet potato","Veg mix","Greek yogurt"
                ].map((g,i)=>(<li key={i} className="bg-neutral-900 rounded-xl px-3 py-2">{g}</li>))}</ul>
              </Section>
            </>)}

            {tab==="supps" && (
              <Section title="Supplement Schedule">
                <div className="text-sm space-y-3">
                  <div><div className="font-semibold">Creatine Monohydrate</div><div>5 g daily, any time. Consistency &gt; timing. Drink water.</div></div>
                  <div><div className="font-semibold">Rule 1 Mass Gainer</div><div>1 serving post-workout (or split into 2× half). On rest days, take between meals.</div></div>
                </div>
              </Section>
            )}

            {tab==="progress" && <Progress metrics={state.metrics} onAdd={addMetric} />}

            {tab==="settings" && (
              <Section title="Settings & Backup">
                <div className="space-y-4 text-sm">
                  <label className="flex items-center gap-2">
                    <input type="checkbox" checked={state.settings.usesMilkInGainer}
                      onChange={e=>setState(s=>({...s,settings:{...s.settings,usesMilkInGainer:e.target.checked}}))} />
                    Use milk in Mass Gainer (adds calories)
                  </label>
                  <div className="text-xs text-neutral-400">To install as an app: Share → Add to Home Screen (Safari/Chrome).</div>
                </div>
              </Section>
            )}

            <footer className="text-center text-xs text-neutral-500 mt-8 mb-4">© {new Date().getFullYear()} Steve Fit – Personal Plan</footer>
          </div>

          <!-- Bottom tab bar -->
          <div className="fixed bottom-3 left-1/2 -translate-x-1/2 max-w-2xl w-[92%] md:w-[720px] bg-neutral-900/80 backdrop-blur rounded-2xl ring-1 ring-white/10 shadow-lg">
            <div className="grid grid-cols-5">
              {["today","workouts","meals","supps","progress"].map(k=> (
                <button key={k} onClick={()=>setTab(k)} className={cls("py-3 text-sm font-medium", tab===k?"text-indigo-400":"text-neutral-400")}>{k[0].toUpperCase()+k.slice(1)}</button>
              ))}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
